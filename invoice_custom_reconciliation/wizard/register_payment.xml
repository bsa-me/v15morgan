<?xml version="1.0" encoding="utf-8"?>
<odoo>
        <record id="view_register_payment_form" model="ir.ui.view">
            <field name="name">register.payment.form</field>
            <field name="model">register.payment</field>
            <field name="arch" type="xml">
                <form string="Register Payment">
                    <group>
                        <field name='payment_amount' widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        <field name='local_payment_amount' widget='monetary' options="{'currency_field': 'local_currency_id'}"/>
                        <field name='move_ids' widget='many2many_tags' invisible='1'/>
                        <field name='local_currency_id' invisible='1'/>
                        <field name='currency_id' invisible='1'/>
                        <field name='partner_id' invisible='1'/>
                        <field name='payment_id' invisible='1'/>
                    </group>
                    <group>
                        <field name='payment_line_ids' context="{'default_partner_id': partner_id}" nolabel='1'>
                        
                            <tree editable='bottom'>
                                <field name="move_id" options="{'no_open':True,'no_create':True}" domain="[('id','!=',parent.move_ids),('state','!=','draft'),('partner_id','=',partner_id),('type','=','out_invoice'),('amount_residual','>',0)]"/>
                                <field name='amount'  readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                <field name='allocated_amount' widget='monetary' options="{'currency_field': 'payment_currency'}"/>
                                <field name='partner_id' invisible='1'/>
                                <field name='currency_id' invisible='1'/>
                                <field name='payment_currency' invisible='1'/>
                            </tree>
                        </field>
                    </group>
                    <footer>
                        <button string="Apply" name="action_register_payment" type="object" class="btn-primary"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <record id="view_register_refund_form" model="ir.ui.view">
            <field name="name">register.refund.form</field>
            <field name="model">register.payment</field>
            <field name="arch" type="xml">
                <form string="Register Payment">
                    <group>
                        <field name='payment_amount' widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        <field name='local_payment_amount' widget='monetary' options="{'currency_field': 'local_currency_id'}"/>
                        <field name='local_currency_id' invisible='1'/>
                        <field name='currency_id' invisible='1'/>
                        <field name='partner_id' invisible='1'/>
                        <field name='payment_id' invisible='1'/>
                    </group>
                    <group>
                        <field name='payment_line_ids' context="{'default_partner_id': partner_id}" nolabel='1'>
                        
                            <tree editable='bottom'>
                                <field name='move_id' options="{'no_open':True,'no_create':True}" domain="[('over_due_payment','&lt;',0),('partner_id','=',partner_id)]"/>
                                <field name='amount' readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                <field name='allocated_amount' widget='monetary' options="{'currency_field': 'payment_currency'}"/>
                                <field name='partner_id' invisible='1'/>
                                <field name='currency_id' invisible='1'/>
                                <field name='payment_currency' invisible='1'/>
                            </tree>
                        </field>
                    </group>
                    <footer>
                        <button string="Apply" name="action_register_payment" type="object" class="btn-primary"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <record id="register_payment_window_action" model="ir.actions.act_window">
            <field name="name">Register Payment</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">register.payment</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_register_payment_form"/>
            <field name="target">new</field>
            <field name="context">{}</field>
        </record>
</odoo>
