<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<template id="report_customer_statement">
			<t t-call="web.external_layout">
			  <t t-set="company" t-value="doc.balance_invoice_ids.company_id"/>
				<t t-set="doc" t-value="doc.with_context({'lang':doc.lang})"/>
				<div class="text-right" style="margin-right: 15em;">
					<p><span t-esc="doc.name"/><br/>
						<span t-esc="doc.street"/><br/>
						<span t-esc="doc.street2"/><br/>
						<span t-esc="doc.city"/>
						<span t-esc="doc.state_id.name"/>
						<span t-esc="doc.zip"/><br/>
						<span t-esc="doc.country_id.name"/>
					</p>
					
					<br/>
				</div>
				<div class="page">
					<div class="container" style="margin:5px 0 0 1px;">
						<h3><strong><span t-field="doc.current_company.soa_name"/></strong></h3>
						<strong><span>Date : </span></strong><span t-esc="datetime.datetime.now().strftime('%d/%m/%Y')"/>
					</div><br/><br/>
					
					<table class="table table-condensed">
						<thead>
							<tr class="text-center">
								<th>Date</th>
								<th>Ref</th>
								<th>Company</th>
								<th>Due Date</th>
								<th>Allocation</th>
								<th>Amount</th>
								<th>Amount($)</th>
								<th>Balance</th>
							</tr>
						</thead>
						<tbody>

   							<t t-set="grand_total" t-value="0.0"/>    
							<t t-set="bal" t-value="0.0"/>
							<t t-set="sub_total" t-value="0.0"/>
							<tr t-foreach="doc.balance_invoice_ids.filtered(lambda r: r.is_payment_move == False).sorted(key=lambda r: r.id)" t-as="line">
								<t t-set="bal" t-value="bal +sub_total "/>
									<td>
										<span t-esc="line.date"/>
									</td>
									<td>
										<span t-esc="line.name"/>
									</td>
									<td>
										<span t-esc="line.company_id.name"/>
									</td>
									<td>
										<span t-esc="line.invoice_date_due"/>
									</td>
									<td>
										<span t-esc="line.allocation"/>
									</td>
									<td class="text-right">
										<span t-esc="line.total_signed_amount" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
									</td>
									<td class="text-right">
										<span t-esc="line.amount_usd" t-options="{'widget': 'monetary', 'display_currency': line.currency_usd}"/>
									</td>
									<td class="text-right">
										<span t-esc="line.balance" t-options="{'widget': 'monetary', 'display_currency': line.currency_usd}"/>
									</td>

							</tr>
						</tbody>
					</table>
					<br/>
				</div>
			</t>
		</template>

		<template id="report_customer">
			<t t-call="web.html_container">
				<t t-foreach="docs" t-as="doc">
					<t t-call="bi_customer_overdue_statement.report_customer_statement" t-lang="doc.lang" />
				</t>
			</t>
		</template>
	</data>
</odoo>
